extends ./global.pug

append @head
    link(rel="stylesheet",href="/css/bus.css")

block @title
    title #{local.bus.short_name} #{local.tool.getGroupText(local.bus.group)[0]} - QDB WIKI 

block @aside
    h1.bdt-h-name
        |#{local.bus.short_name}
        if local.bus.current_code != local.bus.code
            small
                |(原
                b #{local.bus.code}
                |)
    p.bdt-h-company #{local.tool.getGroupText(local.bus.group)[0]}
    h2.bdt-h-model
        a(href="/public/model/"+local.bus.model_string) #{local.bus.model_string}
    p.bdt-h-model-detail #{local.bus.model.brand} #{local.tool.getFuelText(local.bus.model.fuel)}
    p.bdt-h-status(class=local.bus.status_string) #{local.bus.status_string}

block @article
    section.s-introduction
        p 上线时间： #{local.bus.time.on}
        if ! local.bus.status.retired
            p
                |当前运营线路：
                -
                    let current_line = local.bus.current_line_string
                    let is_known = true
                    if(!current_line){
                        if(local.bus.shift_records.length){
                            current_line = local.bus.shift_records[local.bus.shift_records.length-1];
                        } else {
                            is_known = false
                        }
                    }

                if is_known 
                    a(href="/public/line/"+current_line.name) #{current_line.name_pretty}
                else
                    span 未知
        else
            p 下线时间： #{local.bus.time.off}
    section.s-history
        h2 调动记录
        ul.s-his-ul
            each record in local.bus.shift_records
                li.s-his-li
                    h3.s-his-date #{record.date}
                    .s-his-detail
                        if record.from == '@OFFLINE'
                            a.s-his-from 重启
                        else if record.from == '@NEW'
                            a.s-his-from 新车
                        else if record.from == '@STANDBY'
                            a.s-his-from 机动
                        else if record.from == 'unknown'
                            a.s-his-from 未知
                        else
                            a.s-his-from(href="/public/line/"+ record.from_line.name) #{record.from_line.name_pretty}
                        .s-his-fake-arrow →
                        if record.to == '@OFFLINE'
                            a.s-his-to 下线
                        else if record.to == '@STANDBY'
                            a.s-his-to 机动
                        else if record.to == 'unknown'
                            a.s-his-to 未知
                        else 
                            a.s-his-to(href="/public/line/"+ record.to_line.name) #{record.to_line.name_pretty}
